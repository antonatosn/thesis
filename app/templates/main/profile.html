{% extends 'base.html' %}

{% block title %}My Profile - SafeDrive Insurance{% endblock %}

{% block content %}
  <div class="row mb-4">
    <div class="col-md-12">
      <h1 class="display-5 mb-3">My Profile</h1>
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h5 class="mb-3">Personal Information</h5>
              <p><strong>Name:</strong> {{ g.user.first_name }} {{ g.user.last_name }}</p>
              <p><strong>Email:</strong> {{ g.user.email }}</p>
              <p><strong>Phone:</strong> {{ g.user.phone }}</p>
              <p><strong>Username:</strong> {{ g.user.username }}</p>
              <a href="{{ url_for('auth.edit_profile') }}" class="btn btn-outline-primary">
                <i class="fas fa-edit me-2"></i> Edit Profile
              </a>
            </div>
            <div class="col-md-6 text-center align-self-center">
              <div class="p-3">
                <div class="display-1 text-primary mb-3">
                  <i class="fas fa-user-circle"></i>
                </div>
                <p class="lead">Member since {{ g.user.created_at.strftime('%B %d, %Y') }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-12">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>My Vehicles</h2>
        <a href="{{ url_for('main.add_car') }}" class="btn btn-primary">
          <i class="fas fa-plus-circle me-2"></i> Add New Vehicle
        </a>
      </div>
      
      {% if cars %}
        <div class="row row-cols-1 row-cols-md-2 g-4">
          {% for car in cars %}
            <div class="col">
              <div class="card h-100 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">{{ car.make }} {{ car.model }} ({{ car.year }})</h5>
                  <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li>
                        <a class="dropdown-item" href="{{ url_for('main.edit_car', id=car.id) }}">
                          <i class="fas fa-edit me-2"></i> Edit
                        </a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="{{ url_for('main.get_quotes', car_id=car.id) }}">
                          <i class="fas fa-tag me-2"></i> Get Quotes
                        </a>
                      </li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <form action="{{ url_for('main.delete_car', id=car.id) }}" method="post" class="d-inline">
                          <button type="submit" class="dropdown-item text-danger" onclick="return confirm('Are you sure you want to delete this vehicle?');">
                            <i class="fas fa-trash-alt me-2"></i> Delete
                          </button>
                        </form>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <p><i class="fas fa-tag me-2 text-muted"></i> License Plate: {{ car.license_plate }}</p>
                      <p><i class="fas fa-tachometer-alt me-2 text-muted"></i> Mileage: {{ car.mileage }} km</p>
                    </div>
                    <div class="col-md-6">
                      <p><i class="fas fa-money-bill-wave me-2 text-muted"></i> Value: €{{ car.vehicle_value }}</p>
                      <p><i class="fas fa-calendar-alt me-2 text-muted"></i> Added: {{ car.created_at.strftime('%b %d, %Y') }}</p>
                    </div>
                  </div>
                </div>
                <div class="card-footer bg-transparent">
                  <a href="{{ url_for('main.get_quotes', car_id=car.id) }}" class="btn btn-primary w-100">
                    <i class="fas fa-calculator me-2"></i> Get Insurance Quotes
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i> You haven't added any vehicles yet. 
          <a href="{{ url_for('main.add_car') }}" class="alert-link">Add your first vehicle</a> to get insurance quotes.
        </div>
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <h2 class="mb-3">My Saved Quotes</h2>
      
      {% if quotes %}
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-light">
              <tr>
                <th>Quote #</th>
                <th>Vehicle</th>
                <th>Insurance Plan</th>
                <th>Price</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for quote_data in quotes %}
                {% set quote = quote_data[0] %}
                {% set make = quote_data[1] %}
                {% set model = quote_data[2] %}
                {% set year = quote_data[3] %}
                {% set plan_name = quote_data[4] %}
                {% set coverage_type = quote_data[5] %}
                <tr>
                  <td>{{ quote.id }}</td>
                  <td>{{ make }} {{ model }} ({{ year }})</td>
                  <td>
                    <span class="badge bg-{% if coverage_type == 'basic' %}secondary{% elif coverage_type == 'standard' %}success{% elif coverage_type == 'premium' %}primary{% else %}info{% endif %}">
                      {{ plan_name }}
                    </span>
                  </td>
                  <td>€{{ quote.price }}/year</td>
                  <td>
                    <span class="badge bg-{% if quote.status == 'pending' %}warning{% elif quote.status == 'approved' %}success{% else %}danger{% endif %}">
                      {{ quote.status.capitalize() }}
                    </span>
                  </td>
                  <td>{{ quote.created_at.strftime('%b %d, %Y') }}</td>
                  <td>
                    <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View Details">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="#" class="btn btn-sm btn-outline-success" data-bs-toggle="tooltip" title="Purchase Policy">
                      <i class="fas fa-shopping-cart"></i>
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i> You don't have any saved quotes yet. 
          {% if cars %}
            <a href="{{ url_for('main.get_quotes', car_id=cars[0].id) }}" class="alert-link">Get quotes for your vehicle</a>.
          {% else %}
            <a href="{{ url_for('main.add_car') }}" class="alert-link">Add a vehicle</a> first to get insurance quotes.
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}